// Vitest Snapshot v1, https://vitest.dev/guide/snapshot.html

exports[`CLI > cli function > should create and run CLI application 1`] = `
"Usage: @ci-dokumentor/cli [options] [command]

Command Line Interface for CI Dokumentor - Automated documentation generator for
CI/CD components

Options:
  -V, --version                 output the version number
  -o, --output-format <format>  Output format for the CLI (choices: "text",
                                "json", "github-action", default: "text")
  -h, --help                    display help for command

Commands:
  generate|gen [options]        Generate documentation from CI/CD manifest files
  migrate [options]             Migrate existing documentation markers from
                                various tools to ci-dokumentor format
  help [command]                display help for command
"
`;

exports[`CLI > cli function > should display generate command usage 1`] = `
"Usage: @ci-dokumentor/cli generate|gen [options]

Generate documentation from CI/CD manifest files

Options:
  -s, --source <file>                Source manifest file path to handle
  -d, --destination <file>           Destination file path for generated
                                     documentation (auto-detected if not
                                     specified)
  -r, --repository <platform>        Repository platform (auto-detected if not
                                     specified) (choices: "github", "git")
  -c, --cicd <platform>              CI/CD platform (auto-detected if not
                                     specified) (choices: "github-actions")
  -i, --include-sections <sections>  Comma-separated list of sections to include
  -e, --exclude-sections <sections>  Comma-separated list of sections to exclude
  --dry-run                          Preview what would be generated without
                                     writing files (default: false)
  --format-link [type]               Transform bare URLs to links. Types: auto
                                     (default autolinks <url>), full
                                     ([url](url)), false (disabled) (default:
                                     "auto")
  -h, --help                         display help for command

Commands:
  help [command]                     display help for command
"
`;

exports[`CLI > cli function > should run generate command in dry-mode 1`] = `
"[DRY RUN] Starting documentation generation...
Source manifest: /test/action.yml
Destination path: test.md
Auto-detected CI/CD platform: github-actions
Repository platform: git
Documentation generated successfully!
(Dry-run) Documentation would be saved to: test.md
âœ… Result:
   - success: true
   - destination: test.md
   - data: Index: test.md
===================================================================
--- test.md
+++ test.md
@@ -0,0 +1,483 @@
+<!-- header:start -->
+
+# ![Icon](data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJmZWF0aGVyIGZlYXRoZXItYm9vay1vcGVuIiBjb2xvcj0iYmx1ZSI+PHBhdGggZD0iTTIgM2g2YTQgNCAwIDAgMSA0IDR2MTRhMyAzIDAgMCAwLTMtM0gyeiI+PC9wYXRoPjxwYXRoIGQ9Ik0yMiAzaC02YTQgNCAwIDAgMC00IDR2MTRhMyAzIDAgMCAxIDMtM2g3eiI+PC9wYXRoPjwvc3ZnPg==) GitHub Action: CI Dokumentor
+
+<!-- header:end -->
+<!-- badges:start -->
+
+[![Marketplace](https://img.shields.io/badge/Marketplace-ci--dokumentor-blue?logo=github-actions)](https://github.com/marketplace/actions/ci-dokumentor)
+[![Release](https://img.shields.io/github/v/release/hoverkraft-tech/ci-dokumentor)](https://github.com/hoverkraft-tech/ci-dokumentor/releases)
+[![Stars](https://img.shields.io/github/stars/hoverkraft-tech/ci-dokumentor?style=social)](https://img.shields.io/github/stars/hoverkraft-tech/ci-dokumentor?style=social)
+[![Coverage Status](https://img.shields.io/badge/Coverage_Status-75%25-brightgreen)](https://example.com/coverage)
+
+<!-- badges:end -->
+<!-- overview:start -->
+
+## Overview
+
+Automatically generate documentation for CI/CD components like GitHub Actions and workflows
+
+<!-- overview:end -->
+<!-- usage:start -->
+
+## Usage
+
+\`\`\`yaml
+- uses: hoverkraft-tech/ci-dokumentor@sha-version # tag
+  with:
+    # Source manifest file path to handle (e.g. \`action.yml\`, \`.github/workflows/ci.yml\`).
+    # This input is required.
+    source: ''
+
+    # Destination path for generated documentation (optional; destination is auto-detected if not specified by the adapter).
+    destination: ''
+
+    # Repository platform (auto-detected if not specified).
+    repository: ''
+
+    # CI/CD platform (\`github-actions\`, \`gitlab-ci\`, etc.).
+    cicd: ''
+
+    # Comma-separated list of sections to include.
+    include-sections: ''
+
+    # Comma-separated list of sections to exclude.
+    exclude-sections: ''
+
+    # Whether to perform a dry run (no files are written).
+    # Default: \`false\`
+    dry-run: 'false'
+
+    # Version to document (auto-detected if not specified).
+    version: ''
+
+    # JSON array of extra badges to include in the documentation.
+    # Each badge should have \`label\`, \`url\`, and optional \`linkUrl\` properties.
+    extra-badges: ''
+
+    # Transform bare URLs to links.
+    # Types: \`auto\` (autolinks), \`full\` (full links), \`false\` (disabled).
+    #
+    # Default: \`auto\`
+    format-link: auto
+
+    # The GitHub token used to fetch repository information.
+    # Default: \`\${{ github.token }}\`
+    github-token: \${{ github.token }}
+
+    # Version of CI Dokumentor to use. See https://github.com/hoverkraft-tech/ci-dokumentor/releases.
+    # Default: \`latest\`
+    ci-dokumentor-version: latest
+\`\`\`
+
+<!-- usage:end -->
+<!-- inputs:start -->
+
+## Inputs
+
+| **Input**                   | **Description**                                                                                                        | **Required** | **Default**           |
+| --------------------------- | ---------------------------------------------------------------------------------------------------------------------- | ------------ | --------------------- |
+| **\`source\`**                | Source manifest file path to handle (e.g. \`action.yml\`, \`.github/workflows/ci.yml\`).                                   | **true**     | -                     |
+| **\`destination\`**           | Destination path for generated documentation (optional; destination is auto-detected if not specified by the adapter). | **false**    | -                     |
+| **\`repository\`**            | Repository platform (auto-detected if not specified).                                                                  | **false**    | -                     |
+| **\`cicd\`**                  | CI/CD platform (\`github-actions\`, \`gitlab-ci\`, etc.).                                                                  | **false**    | -                     |
+| **\`include-sections\`**      | Comma-separated list of sections to include.                                                                           | **false**    | -                     |
+| **\`exclude-sections\`**      | Comma-separated list of sections to exclude.                                                                           | **false**    | -                     |
+| **\`dry-run\`**               | Whether to perform a dry run (no files are written).                                                                   | **false**    | \`false\`               |
+| **\`version\`**               | Version to document (auto-detected if not specified).                                                                  | **false**    | -                     |
+| **\`extra-badges\`**          | JSON array of extra badges to include in the documentation.                                                            | **false**    | -                     |
+|                             | Each badge should have \`label\`, \`url\`, and optional \`linkUrl\` properties.                                              |              |                       |
+| **\`format-link\`**           | Transform bare URLs to links.                                                                                          | **false**    | \`auto\`                |
+|                             | Types: \`auto\` (autolinks), \`full\` (full links), \`false\` (disabled).                                                    |              |                       |
+| **\`github-token\`**          | The GitHub token used to fetch repository information.                                                                 | **false**    | \`\${{ github.token }}\` |
+| **\`ci-dokumentor-version\`** | Version of CI Dokumentor to use. See <https://github.com/hoverkraft-tech/ci-dokumentor/releases>.                      | **false**    | \`latest\`              |
+
+<!-- inputs:end -->
+<!-- outputs:start -->
+
+## Outputs
+
+| **Output**        | **Description**                               |
+| ----------------- | --------------------------------------------- |
+| **\`destination\`** | Destination path for generated documentation. |
+
+<!-- outputs:end -->
+<!-- secrets:start -->
+<!-- secrets:end -->
+<!-- examples:start -->
+
+## Examples
+
+### Example: __shared-ci
+
+\`\`\`yaml
+name: Common Continuous Integration tasks
+
+on:
+  workflow_call:
+    inputs:
+      sign-images:
+        required: true
+        type: boolean
+    outputs:
+      image-tag:
+        description: The image tag for the CI Dokumentor CLI
+        value: \${{ fromJSON(jobs.docker.outputs.built-images).cli.tags[0] }}
+
+permissions:
+  actions: read
+  contents: read
+  packages: read
+  security-events: write
+  statuses: write
+  id-token: write
+
+jobs:
+  linter:
+    uses: hoverkraft-tech/ci-github-common/.github/workflows/linter.yml@sha-version # tag.24.0
+    with:
+      linter-env: |
+        FILTER_REGEX_EXCLUDE=dist/**/*
+        VALIDATE_JSCPD=false
+        VALIDATE_TYPESCRIPT_ES=false
+        VALIDATE_TYPESCRIPT_PRETTIER=false
+        VALIDATE_JAVASCRIPT_ES=false
+        VALIDATE_TSX=false
+
+  nodejs:
+    uses: hoverkraft-tech/ci-github-nodejs/.github/workflows/continuous-integration.yml@sha-version # tag.14.1
+    permissions:
+      id-token: write
+      security-events: write
+      contents: read
+    with:
+      build: |
+        {
+          "commands": ["build"],
+          "artifact": ["packages/docs/build", "packages/cli/dist"]
+        }
+
+  package-test:
+    needs: [linter, nodejs]
+    runs-on: ubuntu-latest
+    steps:
+      - uses: actions/checkout@sha-version # tag.0.0
+      - name: Setup Node.js
+        uses: hoverkraft-tech/ci-github-nodejs/actions/setup-node@sha-version # tag.14.1
+      - name: Download build artifacts
+        uses: actions/download-artifact@sha-version # tag.0.0
+        with:
+          name: build
+          path: .
+      - name: Verify CLI build exists
+        run: |
+          echo "Checking if CLI binary exists..."
+          ls -la packages/cli/dist/bin/ || echo "CLI binary directory missing"
+          if [ ! -f "packages/cli/dist/bin/ci-dokumentor.js" ]; then
+            echo "CLI binary not found, building CLI package..."
+            npx nx build @ci-dokumentor/cli
+          fi
+          ls -la packages/cli/dist/bin/
+      - name: Create package tarball
+        run: |
+          cd packages/cli
+          npm pack --pack-destination \${{ runner.temp }}/
+      - name: Install package globally
+        run: |
+          cd \${{ runner.temp }}
+          npm install -g ./ci-dokumentor-cli-*.tgz
+
+      # Test version command
+      - name: Test version command
+        run: npx ci-dokumentor --version
+
+      # Test help command
+      - name: Test help command
+        run: npx ci-dokumentor --help
+
+      # Test generate command
+      - uses: actions/checkout@sha-version # tag.0.0
+      - name: Test generate command
+        run: |
+          npx ci-dokumentor generate \\
+          --source "action.yml" \\
+          --destination "packages/docs/content/integrations/github-action.md" \\
+          --dry-run
+        env:
+          GITHUB_TOKEN: \${{ secrets.GITHUB_TOKEN }}
+      - name: Upload package tarball
+        uses: actions/upload-artifact@sha-version # tag.6.2
+        with:
+          name: package-tarball
+          path: \${{ runner.temp }}/ci-dokumentor-cli-*.tgz
+
+  docker:
+    needs: [linter, nodejs]
+    uses: hoverkraft-tech/ci-github-container/.github/workflows/docker-build-images.yml@sha-version # tag.27.1
+    permissions:
+      contents: read
+      issues: read
+      packages: write
+      pull-requests: read
+      id-token: write
+    secrets:
+      oci-registry-password: \${{ secrets.GITHUB_TOKEN }}
+    with:
+      sign: \${{ inputs.sign-images }}
+      images: |
+        [
+          {
+            "name": "cli",
+            "context": ".",
+            "dockerfile": "docker/Dockerfile",
+            "target": "production",
+            "platforms": [
+              "linux/amd64",
+              "linux/arm64"
+            ]
+          }
+        ]
+
+  docker-test:
+    needs: docker
+    runs-on: ubuntu-latest
+    env:
+      IMAGE: \${{ fromJSON(needs.docker.outputs.built-images).cli.images[0] }}
+    steps:
+      # Test version command
+      - run: docker run --rm "$IMAGE" --version
+
+      # Test help command
+      - run: docker run --rm "$IMAGE" --help
+
+      # Test generate command (dry-run) on this repository's action.yml file
+      - uses: actions/checkout@sha-version # tag.0.0
+      - run: |
+          docker run --rm \\
+          -v "$GITHUB_WORKSPACE:$GITHUB_WORKSPACE" \\
+          -u "$(id -u):$(id -g)" \\
+          -w "$GITHUB_WORKSPACE" \\
+          -e GITHUB_TOKEN \\
+          "$IMAGE" \\
+          generate \\
+          --source "action.yml" \\
+          --destination "packages/docs/content/integrations/github-action.md" \\
+          --dry-run
+        env:
+          GITHUB_TOKEN: \${{ secrets.GITHUB_TOKEN }}
+
+  action-test:
+    needs: docker
+    runs-on: ubuntu-latest
+    steps:
+      - uses: actions/checkout@sha-version # tag.0.0
+
+      - id: generate-docs
+        uses: ./@sha-version # tag
+        with:
+          ci-dokumentor-version: \${{ fromJSON(needs.docker.outputs.built-images).cli.tags[0] }}
+          source: action.yml
+          destination: packages/docs/content/integrations/github-action.md
+          github-token: \${{ secrets.GITHUB_TOKEN }}
+
+      - run: |
+          # Assert generate-docs action outputs
+          output_destination="\${{ steps.generate-docs.outputs.destination }}"
+          expected_output_destination="packages/docs/content/integrations/github-action.md"
+          if [ "$output_destination" != "$expected_output_destination" ]; then
+            echo "Error: Unexpected output destination"
+            exit 1
+          fi
+\`\`\`
+
+### Example: main-ci
+
+\`\`\`yaml
+name: Internal - Main - Continuous Integration
+
+on:
+  push:
+    branches: [main]
+    tags: ['*']
+
+  workflow_dispatch:
+
+  schedule:
+    - cron: '25 8 * * 1'
+
+permissions:
+  actions: read
+  contents: read
+  issues: read
+  packages: write
+  pull-requests: read
+  security-events: write
+  statuses: write
+  # FIXME: This is a workaround for having workflow ref. See https://github.com/orgs/community/discussions/38659
+  id-token: write
+
+concurrency:
+  group: \${{ github.workflow }}-\${{ github.ref }}
+  cancel-in-progress: true
+
+jobs:
+  clean:
+    uses: hoverkraft-tech/ci-github-container/.github/workflows/prune-pull-requests-images-tags.yml@sha-version # tag.27.1
+    with:
+      images: '["cli"]'
+
+  ci:
+    uses: ./.github/workflows/__shared-ci.yml
+    secrets: inherit
+    with:
+      sign-images: true
+
+  docs-action:
+    needs: ci
+    if: github.event_name != 'schedule'
+    runs-on: ubuntu-latest
+    steps:
+      - uses: actions/checkout@sha-version # tag.0.0
+
+      - id: generate-readme
+        uses: ./@sha-version # tag
+        with:
+          ci-dokumentor-version: \${{ needs.ci.outputs.image-tag }}
+          source: action.yml
+          include-sections: badges,contributing,license,generated
+          extra-badges: |
+            [
+              {
+                "label": "Total Downloads",
+                "url": "https://img.shields.io/npm/dm/@ci-dokumentor/cli",
+                "linkUrl": "https://www.npmjs.com/package/@ci-dokumentor/cli"
+              },
+              {
+                "label": "Coverage Status",
+                "url": "https://codecov.io/gh/hoverkraft-tech/ci-dokumentor/branch/main/graph/badge.svg",
+                "linkUrl": "https://codecov.io/gh/hoverkraft-tech/ci-dokumentor"
+              },
+              {
+                "label": "Continuous Integration",
+                "url": "https://github.com/hoverkraft-tech/ci-dokumentor/actions/workflows/main-ci.yml/badge.svg",
+                "linkUrl": "https://github.com/hoverkraft-tech/ci-dokumentor/actions/workflows/main-ci.yml"
+              }
+            ]
+          github-token: \${{ secrets.GITHUB_TOKEN }}
+
+      - id: generate-docs
+        uses: ./@sha-version # tag
+        with:
+          ci-dokumentor-version: \${{ needs.ci.outputs.image-tag }}
+          source: action.yml
+          destination: packages/docs/content/integrations/github-action.md
+          include-sections: usage,inputs,outputs,secrets
+          github-token: \${{ secrets.GITHUB_TOKEN }}
+          format-link: full
+
+      - uses: actions/create-github-app-token@sha-version # tag.1.4
+        id: generate-token
+        with:
+          app-id: \${{ vars.CI_BOT_APP_ID }}
+          private-key: \${{ secrets.CI_BOT_APP_PRIVATE_KEY }}
+
+      - uses: hoverkraft-tech/ci-github-common/actions/create-and-merge-pull-request@sha-version # tag.24.0
+        with:
+          github-token: \${{ steps.generate-token.outputs.token }}
+          branch: docs/action-documentation-update
+          title: 'docs: update action documentation'
+          body: Update action documentation
+          commit-message: |
+            docs: update action documentation
+
+            [skip ci]
+
+  npm-publish:
+    needs: ci
+    if: github.event_name == 'push'
+    runs-on: ubuntu-latest
+    permissions:
+      contents: read
+      id-token: write
+    steps:
+      - uses: actions/checkout@sha-version # tag.0.0
+      - name: Setup Node.js
+        uses: hoverkraft-tech/ci-github-nodejs/actions/setup-node@sha-version # tag.14.1
+
+      - name: Download package tarball
+        uses: actions/download-artifact@sha-version # tag.0.0
+        with:
+          name: package-tarball
+          path: .
+      - name: Publish CLI to npm
+        run: |
+          npm publish ci-dokumentor-cli-*.tgz --provenance --access public --dry-run
+        env:
+          NODE_AUTH_TOKEN: \${{ secrets.NPM_TOKEN }}
+
+  docs-deploy:
+    needs: ci
+    if: github.ref == 'refs/heads/main' && github.event_name != 'schedule'
+    runs-on: ubuntu-latest
+    permissions:
+      pages: write
+      id-token: write
+    environment:
+      name: github-pages
+      url: \${{ steps.deployment.outputs.url }}
+    steps:
+      - name: Deploy to GitHub Pages
+        id: deployment
+        uses: hoverkraft-tech/ci-github-publish/actions/deploy/github-pages@sha-version # tag
+        with:
+          build-path: packages/docs/build
+          build-artifact-name: build
+\`\`\`
+
+### Example: pull-request-ci
+
+\`\`\`yaml
+name: Pull request - Continuous Integration
+
+on:
+  merge_group:
+  pull_request:
+    branches: [main]
+
+permissions:
+  actions: read
+  contents: read
+  id-token: write
+  issues: read
+  packages: write
+  pull-requests: read
+  security-events: write
+  statuses: write
+
+concurrency:
+  group: \${{ github.workflow }}-\${{ github.ref }}
+  cancel-in-progress: true
+
+jobs:
+  ci:
+    uses: ./.github/workflows/__shared-ci.yml
+    secrets: inherit
+    with:
+      sign-images: false
+\`\`\`
+
+
+<!-- examples:end -->
+<!-- contributing:start -->
+<!-- contributing:end -->
+<!-- security:start -->
+<!-- security:end -->
+<!-- license:start -->
+<!-- license:end -->
+<!-- generated:start -->
+
+---
+
+This documentation was automatically generated by [CI Dokumentor](https://github.com/hoverkraft-tech/ci-dokumentor).
+
+<!-- generated:end -->
"
`;
